<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Moon Sign | DEEP LOVERS LAB</title>

  <!-- Astronomy Engine (browser build) -->
  <script src="https://unpkg.com/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>

  <style>
    :root{
      --bg:#050507;
      --panel:#0d0b10;
      --text:#f3eef7;
      --muted:#b8a9c6;
      --gold:#d7b46a;
      --wine:#5b1020;
      --line:rgba(215,180,106,.25);
    }
    body{
      margin:0;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(91,16,32,.35), transparent 60%),
        radial-gradient(700px 500px at 80% 0%, rgba(215,180,106,.12), transparent 60%),
        radial-gradient(900px 700px at 60% 100%, rgba(91,16,32,.20), transparent 65%),
        var(--bg);
      color:var(--text);
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
      letter-spacing: .02em;
    }
    .wrap{max-width:980px;margin:0 auto;padding:28px 18px 80px;}
    header{padding:18px 6px 10px;}
    .brand{
      font-weight:700;
      letter-spacing:.18em;
      color:var(--gold);
      font-size:12px;
      text-transform:uppercase;
    }
    h1{margin:10px 0 6px;font-size:28px;line-height:1.2;}
    .sub{color:var(--muted);margin:0 0 18px;line-height:1.7;}

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,.02), transparent 35%), var(--panel);
      border:1px solid var(--line);
      border-radius:16px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
    @media (max-width:720px){.grid{grid-template-columns:1fr;}}
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input, select{
      width:100%;
      background:#09070c;
      color:var(--text);
      border:1px solid rgba(215,180,106,.22);
      border-radius:12px;
      padding:12px 12px;
      outline:none;
    }
    input:focus, select:focus{border-color:rgba(215,180,106,.55);}
    .row{margin-top:12px;}
    button{
      width:100%;
      margin-top:14px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(215,180,106,.45);
      background:linear-gradient(90deg, rgba(91,16,32,.75), rgba(215,180,106,.18));
      color:var(--text);
      font-weight:700;
      letter-spacing:.08em;
      cursor:pointer;
    }
    button:hover{filter:brightness(1.05);}

    .result{
      margin-top:16px;
      padding:18px;
      border-radius:16px;
      border:1px solid rgba(215,180,106,.22);
      background:rgba(0,0,0,.25);
    }
    .note{color:var(--muted);line-height:1.75;margin:10px 0 0;font-size:13px;}
    .tiny{color:var(--muted);font-size:12px;margin-top:10px;line-height:1.7;}
    .hr{height:1px;background:rgba(215,180,106,.18);margin:14px 0;}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}

    /* Result styling */
    .result-title{
      margin: 0 0 10px;
      font-size: 13px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(215,180,106,.95);
    }
    .moon-name{
      margin: 0 0 10px;
      font-size: 20px;
      line-height: 1.35;
    }
    .moon-name span{color:var(--gold);}
    .label{
      margin: 16px 0 6px;
      color: var(--gold);
      font-weight: 700;
      letter-spacing: .08em;
      font-size: 12px;
    }
    .moon-text p{
      margin: 0 0 6px;
      line-height: 1.85;
      color: rgba(243,238,247,.98);
    }
    .moon-note{
      margin: 18px 0 0;
      padding-top: 14px;
      border-top: 1px solid rgba(215,180,106,.18);
      color: rgba(184,169,198,.95);
      line-height: 1.85;
      font-size: 13px;
      text-align: center;
    }
    .moon-note span{color: rgba(215,180,106,.95); font-weight: 700;}

    .deep-section{
      margin-top: 18px;
      padding: 16px;
      border-radius: 14px;
      border: 1px solid rgba(215,180,106,.18);
      background: rgba(13,11,16,.55);
    }
    .deep-section h3{
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing: .10em;
      color: rgba(215,180,106,.95);
    }
    .deep-section p{
      margin: 0 0 10px;
      line-height: 1.85;
      color: rgba(243,238,247,.96);
    }
    .deep-list{
      margin: 10px 0 12px;
      padding-left: 18px;
      color: rgba(243,238,247,.94);
      line-height: 1.85;
    }
    .deep-note{
      margin-top: 12px;
      color: rgba(184,169,198,.95);
      font-style: italic;
    }

    /* Side-by-side */
    .compare-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top:10px;
    }
    @media (max-width:720px){.compare-grid{grid-template-columns:1fr;}}
    .card{
      border-radius:14px;
      border:1px solid rgba(215,180,106,.18);
      background:rgba(13,11,16,.45);
      padding:14px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(215,180,106,.25);
      color:rgba(215,180,106,.95);
      font-size:11px;
      letter-spacing:.12em;
      text-transform:uppercase;
      margin-bottom:10px;
    }

    footer{margin-top:18px;color:rgba(184,169,198,.9);font-size:12px;line-height:1.7;}
    a{color:var(--gold);text-decoration:none;}
    a:hover{text-decoration:underline;}
 .link-list{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:16px;
}
.link-btn{
  display:block;
  text-align:center;
  padding:14px 16px;
  border-radius:12px;
  border:1px solid rgba(215,180,106,.35);
  color:#f3eef7;
  text-decoration:none;
  letter-spacing:.08em;
  background:rgba(13,11,16,.6);
}

.link-btn:hover{
  background:rgba(215,180,106,.12);
}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">DEEP LOVERS LAB</div>
      <h1>Moon Sign Horoscope</h1>
      <p class="sub">
        æœˆã¯ã€ã‚ãªãŸã®ã€Œåå¿œã€ã¨ã€Œå®‰å¿ƒã€ã‚’å®ˆã‚‹å ´æ‰€ã€‚<br>
        äºŒäººã®æœˆæ˜Ÿåº§ã‚’ä¸¦ã¹ã¦ã€ã‚ºãƒ¬ã®â€œæ„å‘³â€ã¨â€œæ‰±ã„æ–¹â€ã‚’é™ã‹ã«æ•´ãˆã¾ã™ã€‚
      </p>
    </header>

    <section class="panel">
      <div class="result-title">Your Data</div>
      <div class="grid">
        <div>
          <label>ã‚ãªãŸã®ç”Ÿå¹´æœˆæ—¥ï¼ˆå¿…é ˆï¼‰</label>
          <input id="date" type="date" />
        </div>
        <div>
          <label>ã‚ãªãŸã®å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label>
          <input id="time" type="time" placeholder="12:34" />
        </div>
      </div>

      <div class="grid row">
        <div>
          <label>ã‚ãªãŸã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³</label>
          <select id="tz">
            <option value="+09:00" selected>+09:00ï¼ˆæ—¥æœ¬ï¼‰</option>
            <option value="+00:00">+00:00ï¼ˆUTCï¼‰</option>
            <option value="-05:00">-05:00</option>
            <option value="-08:00">-08:00</option>
            <option value="+01:00">+01:00</option>
            <option value="+10:00">+10:00</option>
          </select>
        </div>
        <div>
          <label>ã€€</label>
          <button id="calc">ã‚ãªãŸã®æœˆæ˜Ÿåº§ã‚’å‡ºã™</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="result-title">His Data</div>
      <div class="grid">
        <div>
          <label>å½¼ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆå¿…é ˆï¼‰</label>
          <input id="p_date" type="date" />
        </div>
        <div>
          <label>å½¼ã®å‡ºç”Ÿæ™‚åˆ»ï¼ˆä»»æ„ï¼‰</label>
          <input id="p_time" type="time" placeholder="12:34" />
        </div>
      </div>

      <div class="grid row">
        <div>
          <label>å½¼ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³</label>
          <select id="p_tz">
            <option value="+09:00" selected>+09:00ï¼ˆæ—¥æœ¬ï¼‰</option>
            <option value="+00:00">+00:00ï¼ˆUTCï¼‰</option>
            <option value="-05:00">-05:00</option>
            <option value="-08:00">-08:00</option>
            <option value="+01:00">+01:00</option>
            <option value="+10:00">+10:00</option>
          </select>
        </div>
        <div>
          <label>ã€€</label>
          <button id="calc_partner">å½¼ã®æœˆæ˜Ÿåº§ã‚’å‡ºã™</button>
        </div>
      </div>

      <div class="tiny">
        â€»å‡ºç”Ÿæ™‚åˆ»ãŒä¸æ˜ã®å ´åˆã€æœˆãŒæ˜Ÿåº§ã®å¢ƒç•Œä»˜è¿‘ã«ã‚ã‚‹ã¨çµæœãŒå‰å¾Œã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆç›®å®‰ï¼šÂ±1æ˜Ÿåº§ã®å¯èƒ½æ€§ï¼‰ã€‚<br>
        â€»ã‚ˆã‚Šç²¾å¯†ã«èª­ã¿ãŸã„å ´åˆã¯å‡ºç”Ÿæ™‚åˆ»ï¼ˆåˆ†ã¾ã§ï¼‰ãŒæ¨å¥¨ã§ã™ã€‚
      </div>

      <div id="out" class="result" style="display:none"></div>
    </section>
    <section class="deep-section">
  <h3>DEEP LOVERS LABï½œLinks</h3>

  <p class="deep-note">
    æ·±ãã¤ãªãŒã‚‹å‰ã«ã€<br>
    ã¾ãšã¯ã€Œæ„Ÿæƒ…ã®æ§‹é€ ã€ã‚’çŸ¥ã‚‹ã¨ã“ã‚ã‹ã‚‰ã€‚
  </p>

  <div class="link-list">
    <a href="https://note.com/deep_lovers_lab" target="_blank" class="link-btn">
      ğŸ“– noteï½œç„¡æ–™è¨˜äº‹ã‚’èª­ã‚€
    </a>

    <a href="https://example.com/menu" target="_blank" class="link-btn">
      ğŸ’ é‘‘å®šMENU
    </a>

    <a href="https://instagram.com/deep.lovers.lab" target="_blank" class="link-btn">
      ğŸ’¬ Instagramï½œDMç›¸è«‡ã¯ã“ã¡ã‚‰
    </a>
  </div>
</section>

    <footer>
      <div class="hr"></div>
      <div>DEEP LOVERS LABï½œPsychology Ã— Astrology</div>
    </footer>
  </div>

<script>
  // ---- Texts: DEEP LOVERS LAB ver. ----
  const MOON_TEXT = {
    "ç‰¡ç¾Šåº§": { safe:"æ„Ÿæƒ…ã‚’æ­¢ã‚ãšã€ã™ãã«å‹•ã‘ã‚‹ã“ã¨ã€‚<br>ã€Œä»Šã“ã†æ„Ÿã˜ã¦ã„ã‚‹ã€ã¨è¡¨ç¾ã§ãã‚‹è‡ªç”±ã€‚", hurt:"åå¿œã‚’å¾…ãŸã•ã‚Œã‚‹ã“ã¨ã€‚<br>æ„Ÿæƒ…ã‚’æŠ‘ãˆè¾¼ã¾ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€å…ˆã«å‹•ã„ã¦ç¢ºã‹ã‚ã«ã„ãã€‚<br>å¼·ãè¦‹ãˆã¦ã€å®Ÿã¯ã¨ã¦ã‚‚æ­£ç›´ã€‚" },
    "ç‰¡ç‰›åº§": { safe:"å¤‰ã‚ã‚‰ãªã„æ¸©åº¦ã€‚<br>è§¦ã‚Œã‚‰ã‚Œã‚‹å®Ÿæ„Ÿã€åŒã˜ãƒªã‚ºãƒ ã®æ™‚é–“ã€‚", hurt:"æ€¥ãªå¤‰åŒ–ã€‚<br>è¨€è‘‰ã ã‘ã§æ¸ˆã¾ã•ã‚Œã‚‹ã“ã¨ã€‚", love:"å®‰å¿ƒã§ãã‚‹ã¨æ·±ãç•™ã¾ã‚‹ã€‚<br>ä¸å®‰ã«ãªã‚‹ã¨ã€é™ã‹ã«å¿ƒã‚’é–‰ã˜ã‚‹ã€‚" },
    "åŒå­åº§": { safe:"è¨€è‘‰ãŒå¾ªç’°ã—ã¦ã„ã‚‹ã“ã¨ã€‚<br>æ°—æŒã¡ã‚’èª¬æ˜ã§ãã‚‹ä½™ç™½ã€‚", hurt:"èª¬æ˜ã®ãªã„æ²ˆé»™ã€‚<br>ã€Œã‚ã‹ã£ã¦å½“ç„¶ã€ã¨ã„ã†æ…‹åº¦ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨è€ƒãˆç¶šã‘ã‚‹ã€‚<br>è©±ã›ãªããªã‚‹ã¨ã€æ°—æŒã¡ãŒé›¢ã‚ŒãŸã‚ˆã†ã«æ„Ÿã˜ã‚‹ã€‚" },
    "èŸ¹åº§": { safe:"æ„Ÿæƒ…ã‚’ãã®ã¾ã¾å—ã‘å–ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã“ã¨ã€‚<br>å®ˆã‚‰ã‚Œã¦ã„ã‚‹æ„Ÿè¦šã€‚", hurt:"å†·ãŸã•ã€‚<br>å¤§åˆ‡ã«ã—ã¦ã„ã‚‹æ°—æŒã¡ã‚’è»½ãæ‰±ã‚ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€è·é›¢ã‚’ç¸®ã‚ãŸããªã‚‹ã€‚<br>æ·±ãã¤ãªãŒã‚‹ã»ã©ã€ç¹Šç´°ã«ãªã‚‹ã€‚" },
    "ç…å­åº§": { safe:"å­˜åœ¨ãã®ã‚‚ã®ã‚’è‚¯å®šã•ã‚Œã‚‹ã“ã¨ã€‚<br>ã€Œã‚ãªãŸãŒå¥½ãã€ã¨ã¯ã£ãã‚Šä¼ãˆã‚‰ã‚Œã‚‹ã“ã¨ã€‚", hurt:"ç„¡é–¢å¿ƒã€‚<br>å½“ãŸã‚Šå‰ã®ã‚ˆã†ã«æ‰±ã‚ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€æ„›ã‚’ç¢ºèªã—ãŸããªã‚‹ã€‚<br>èª‡ã‚Šã¨ç”˜ãˆãŒåŒæ™‚ã«æºã‚Œã‚‹ã€‚" },
    "ä¹™å¥³åº§": { safe:"æ•´ã£ã¦ã„ã‚‹é–¢ä¿‚ã€‚<br>å°ã•ãªæ°—é…ã‚ŠãŒç©ã¿é‡ãªã£ã¦ã„ã‚‹ã“ã¨ã€‚", hurt:"é›‘ã«æ‰±ã‚ã‚Œã‚‹ã“ã¨ã€‚<br>åŠªåŠ›ãŒè¦‹ãˆãªã„çŠ¶æ…‹ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€è‡ªåˆ†ã‚’èª¿æ•´ã—å§‹ã‚ã‚‹ã€‚<br>æ°—ã¥ã‹ã‚Œãªã„ã¾ã¾æ¶ˆè€—ã—ã‚„ã™ã„ã€‚" },
    "å¤©ç§¤åº§": { safe:"å¯¾ç­‰ã•ã€‚<br>æ„Ÿæƒ…ã‚’å…±æœ‰ã—åˆãˆã‚‹ãƒãƒ©ãƒ³ã‚¹ã€‚", hurt:"ä¸€æ–¹çš„ãªé–¢ä¿‚ã€‚<br>æ°—æŒã¡ã®é‡ã•ãŒåã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€è·é›¢ã‚’æ¸¬ã‚Šç›´ã™ã€‚<br>èª¿å’Œã‚’ä¿ã¨ã†ã¨ã—ã¦æœ¬éŸ³ã‚’å¾Œå›ã—ã«ã—ãŒã¡ã€‚" },
    "è åº§": { safe:"è¡¨é¢ã§ã¯ãªã„æ·±ã•ã€‚<br>æœ¬éŸ³ã«è§¦ã‚Œã‚‰ã‚Œã¦ã„ã‚‹æ„Ÿè¦šã€‚", hurt:"è»½ã•ã€‚<br>å¤§åˆ‡ãªæ„Ÿæƒ…ã‚’æ›–æ˜§ã«ã•ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€å¿ƒã®å¥¥ã‚’è©¦ã™ã€‚<br>ä¸€åº¦æ·±ãçµã¶ã¨ã€ç°¡å˜ã«ã¯é›¢ã‚Œãªã„ã€‚" },
    "å°„æ‰‹åº§": { safe:"è¦‹é€šã—ã€‚<br>ã“ã®é–¢ä¿‚ãŒã©ã“ã¸å‘ã‹ã†ã‹ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹ã“ã¨ã€‚", hurt:"é–‰å¡æ„Ÿã€‚<br>ç†ç”±ã®ãªã„åˆ¶é™ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€æ„å‘³ã‚’æ¢ã—ã«ã„ãã€‚<br>è‡ªç”±ã§ã„ãŸã„ã®ã¯ã€å¿ƒãŒæ€¯ãˆã¦ã„ã‚‹ã‚µã‚¤ãƒ³ã§ã‚‚ã‚ã‚‹ã€‚" },
    "å±±ç¾Šåº§": { safe:"ç¾å®Ÿçš„ãªå®‰å®šã€‚<br>å®ˆã‚Œã‚‹åœŸå°ãŒã‚ã‚‹ã“ã¨ã€‚", hurt:"ç„¡è²¬ä»»ã•ã€‚<br>æ„Ÿæƒ…ã ã‘ã§èªã‚‰ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€æ„Ÿæƒ…ã‚’æŠ‘ãˆã‚‹ã€‚<br>å¼·ãè¦‹ã›ãªãŒã‚‰ã€å†…å´ã§è€ãˆã¦ã„ã‚‹ã€‚" },
    "æ°´ç“¶åº§": { safe:"è‡ªç”±ã¨è·é›¢ã€‚<br>ç†è§£ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†æ„Ÿè¦šã€‚", hurt:"æ„Ÿæƒ…ã®æŠ¼ã—ã¤ã‘ã€‚<br>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã•ã‚Œã‚‹ã“ã¨ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€ä¸€åº¦é›¢ã‚Œã¦è€ƒãˆã‚‹ã€‚<br>å†·ãŸãè¦‹ãˆã¦ã€å®Ÿã¯ã¨ã¦ã‚‚æ•æ„Ÿã€‚" },
    "é­šåº§": { safe:"æº¶ã‘åˆã†æ„Ÿè¦šã€‚<br>æ„Ÿæƒ…ã‚’å…±æœ‰ã§ãã‚‹ã‚„ã•ã—ã•ã€‚", hurt:"ç¾å®Ÿã ã‘ã‚’çªãã¤ã‘ã‚‰ã‚Œã‚‹ã“ã¨ã€‚<br>å…±æ„Ÿã®ãªã„æ­£è«–ã€‚", love:"ä¸å®‰ã«ãªã‚‹ã¨ã€å¢ƒç•ŒãŒæ›–æ˜§ã«ãªã‚‹ã€‚<br>ç›¸æ‰‹ã®æ„Ÿæƒ…ã¾ã§èƒŒè² ã„ã‚„ã™ã„ã€‚" }
  };

  // ---- Relationship profiles (ã‚ºãƒ¬ã®æ‰±ã„æ–¹ã®æ ¸) ----
  // approach: è¿‘ã¥ã/è·é›¢ã‚’å–ã‚‹/æ•´ãˆã‚‹ï¼ˆä¸­é–“ï¼‰
  // confirm: è¨€è‘‰/ä½“æ„Ÿï¼ˆè¡Œå‹•ï¼‰/æœªæ¥ï¼ˆè¦‹é€šã—ï¼‰
  // tempo: é€Ÿã„/ä¸€å®š/æ…é‡
  const SIGN_PROFILE = {
    "ç‰¡ç¾Šåº§": { approach:"è¿‘ã¥ã", confirm:"å³æ™‚", channel:"è¨€è‘‰", tempo:"é€Ÿã„" },
    "ç‰¡ç‰›åº§": { approach:"ä¸€å®š", confirm:"ä½“æ„Ÿ", channel:"è¡Œå‹•", tempo:"ä¸€å®š" },
    "åŒå­åº§": { approach:"æ•´ãˆã‚‹", confirm:"è¨€è‘‰", channel:"è¨€è‘‰", tempo:"é€Ÿã„" },
    "èŸ¹åº§":   { approach:"è¿‘ã¥ã", confirm:"ä½“æ„Ÿ", channel:"ã¬ãã‚‚ã‚Š", tempo:"ä¸€å®š" },
    "ç…å­åº§": { approach:"è¿‘ã¥ã", confirm:"è¨€è‘‰", channel:"è‚¯å®š", tempo:"é€Ÿã„" },
    "ä¹™å¥³åº§": { approach:"æ•´ãˆã‚‹", confirm:"è¡Œå‹•", channel:"é…æ…®", tempo:"æ…é‡" },
    "å¤©ç§¤åº§": { approach:"æ•´ãˆã‚‹", confirm:"è¨€è‘‰", channel:"å¯¾è©±", tempo:"ä¸€å®š" },
    "è åº§":   { approach:"è¿‘ã¥ã", confirm:"æ·±ã•", channel:"æœ¬éŸ³", tempo:"æ…é‡" },
    "å°„æ‰‹åº§": { approach:"è·é›¢ã‚’å–ã‚‹", confirm:"æœªæ¥", channel:"è¦‹é€šã—", tempo:"é€Ÿã„" },
    "å±±ç¾Šåº§": { approach:"è·é›¢ã‚’å–ã‚‹", confirm:"ç¾å®Ÿ", channel:"è²¬ä»»", tempo:"æ…é‡" },
    "æ°´ç“¶åº§": { approach:"è·é›¢ã‚’å–ã‚‹", confirm:"ç†è§£", channel:"å°Šé‡", tempo:"ä¸€å®š" },
    "é­šåº§":   { approach:"è¿‘ã¥ã", confirm:"å…±æ„Ÿ", channel:"ã‚„ã•ã—ã•", tempo:"ä¸€å®š" }
  };

  // ---- Helpers ----
  function parseOffset(tzStr){
    const m = tzStr.match(/^([+-])(\d{2}):(\d{2})$/);
    if(!m) return 0;
    const sign = (m[1] === "-") ? -1 : 1;
    const hh = parseInt(m[2],10);
    const mm = parseInt(m[3],10);
    return sign * (hh*60 + mm);
  }
  function clamp360(deg){
    let x = deg % 360;
    if(x < 0) x += 360;
    return x;
  }
  function signFromLongitude(lon){
    const idx = Math.floor(lon / 30) % 12;
    const degInSign = lon - idx*30;
    const names = ["ç‰¡ç¾Šåº§","ç‰¡ç‰›åº§","åŒå­åº§","èŸ¹åº§","ç…å­åº§","ä¹™å¥³åº§","å¤©ç§¤åº§","è åº§","å°„æ‰‹åº§","å±±ç¾Šåº§","æ°´ç“¶åº§","é­šåº§"];
    return { name: names[idx], degInSign };
  }
  function toUtcDate(dateStr, timeStr, tzStr){
    if(!dateStr) return null;
    const [Y,M,D] = dateStr.split("-").map(Number);
    let hh = 12, mm = 0; // time not provided -> noon
    if(timeStr){
      [hh,mm] = timeStr.split(":").map(Number);
    }
    const offsetMin = parseOffset(tzStr);
    const utcMillis = Date.UTC(Y, M-1, D, hh, mm) - offsetMin*60*1000;
    return new Date(utcMillis);
  }
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function computeMoon(dateStr, timeStr, tzStr){
    const utcDate = toUtcDate(dateStr, timeStr, tzStr);
    if(!utcDate) return null;

    const sph = Astronomy.EclipticGeoMoon(utcDate);
    const lon = clamp360(sph.lon);
    const s = signFromLongitude(lon);

    const texts = MOON_TEXT[s.name] || { safe:"â€”", hurt:"â€”", love:"â€”" };
    const timeNote = timeStr
      ? `å…¥åŠ›æ™‚åˆ»ï¼š<span class="mono">${escapeHtml(timeStr)}</span>ï¼ˆTZ <span class="mono">${escapeHtml(tzStr)}</span>ï¼‰`
      : `å‡ºç”Ÿæ™‚åˆ»ãŒæœªå…¥åŠ›ã®ãŸã‚ã€<b>12:00</b>ï¼ˆTZ <span class="mono">${escapeHtml(tzStr)}</span>ï¼‰ã§ä»®è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚å¢ƒç•Œä»˜è¿‘ã§ã¯çµæœãŒå‰å¾Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;

    return { sign: s.name, lon, degInSign: s.degInSign, texts, timeNote };
  }

  function renderCard(label, data){
    return `
      <div class="card">
        <div class="pill">${label}</div>
        <div class="moon-name">ğŸŒ™ æœˆæ˜Ÿåº§ï¼š<span>${data.sign}</span></div>
        <div class="note">${data.timeNote}</div>

        <div class="moon-text">
          <p class="label">å®‰å¿ƒã®éµ</p>
          <p>${data.texts.safe}</p>

          <p class="label">å‚·ã¤ãã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆ</p>
          <p>${data.texts.hurt}</p>

          <p class="label">æ‹ã§å‡ºã‚‹åå¿œ</p>
          <p>${data.texts.love}</p>
        </div>
      </div>
    `;
  }

  // ---- "ã‚ºãƒ¬ã®æ‰±ã„æ–¹" generator ----
  function mismatchGuide(youSign, himSign){
    const Y = SIGN_PROFILE[youSign];
    const H = SIGN_PROFILE[himSign];
    if(!Y || !H) return null;

    const gapApproach =
      (Y.approach === H.approach) ? "åŒã˜æ–¹å‘" :
      (Y.approach === "è¿‘ã¥ã" && H.approach === "è·é›¢ã‚’å–ã‚‹") ? "å¯„ã‚‹Ã—é›¢ã‚Œã‚‹" :
      (Y.approach === "è·é›¢ã‚’å–ã‚‹" && H.approach === "è¿‘ã¥ã") ? "é›¢ã‚Œã‚‹Ã—å¯„ã‚‹" :
      "æ•´ãˆã‚‹Ã—åˆ¥æ–¹å‘";

    const gapConfirm =
      (Y.confirm === H.confirm) ? "åŒã˜ç¢ºèªè»¸" :
      `${Y.confirm} Ã— ${H.confirm}`;

    const do1 = (() => {
      // approach pairing suggestions
      if(gapApproach === "å¯„ã‚‹Ã—é›¢ã‚Œã‚‹"){
        return "ç‰‡æ–¹ãŒè¿‘ã¥ãã€ç‰‡æ–¹ãŒé›¢ã‚Œã‚‹ã¨ãã¯ã€Œè¿½ã†ï¼é€ƒã’ã‚‹ã€ã«ãªã‚Šã‚„ã™ã„ã€‚<br>ã„ã£ãŸã‚“<strong>æ™‚é–“ã‚’åŒºåˆ‡ã£ã¦è·é›¢ã‚’è¨±å¯</strong>ã—ã¦ã‹ã‚‰ã€æˆ»ã‚‹ç´„æŸã‚’ä½œã‚‹ã€‚";
      }
      if(gapApproach === "é›¢ã‚Œã‚‹Ã—å¯„ã‚‹"){
        return "é›¢ã‚ŒãŸã„å´ã¯ã€Œå†·ã‚ãŸã€ã§ã¯ãªã<strong>æ•´ãˆã‚‹æ™‚é–“</strong>ã®å¯èƒ½æ€§ã€‚<br>å¯„ã‚ŠãŸã„å´ã¯ã€çŸ­ã„ç¢ºèªã‚’ã‚‚ã‚‰ã£ã¦ã‹ã‚‰å¾…ã¤å½¢ã«ã™ã‚‹ã€‚";
      }
      if(gapApproach === "åŒã˜æ–¹å‘"){
        return "å®‰å¿ƒã®å–ã‚Šæ–¹ãŒä¼¼ã¦ã„ã‚‹ã®ã§ã€ã‚ºãƒ¬ã¯å°ã•ãè¦‹ãˆã‚‹ã€‚<br>ãŸã ã—ã€Œè¨€ã‚ãªãã¦ã‚‚åˆ†ã‹ã‚‹ã€ã«å¯„ã‚‹ã¨èª¤è§£ãŒå¢—ãˆã‚‹ã®ã§ã€<strong>å°ã•ãè¨€èªåŒ–</strong>ã‚’è¶³ã™ã€‚";
      }
      return "ã‚ºãƒ¬ã¯ã€Œç›¸æ€§ã€ã§ã¯ãªãã€<strong>å®‰å¿ƒã«æˆ»ã‚‹é“ãŒé•ã†</strong>ã ã‘ã€‚<br>äºŒäººã®â€œæˆ»ã‚Šæ–¹â€ã‚’å…ˆã«æ±ºã‚ã¦ãŠãã¨è’ã‚Œã«ãã„ã€‚";
    })();

    const do2 = (() => {
      // confirm axis suggestions
      const yNeed = Y.channel;
      const hNeed = H.channel;
      if(Y.confirm === H.confirm){
        return `ç¢ºèªã®è»¸ãŒåŒã˜ã€‚<br><strong>${yNeed}</strong>ã‚’ä¸å¯§ã«ç©ã‚€ã»ã©ã€é–¢ä¿‚ã¯å®‰å®šã—ã‚„ã™ã„ã€‚`;
      }
      return `ç¢ºèªã®è»¸ãŒé•ã†ã€‚<br>ã‚ãªãŸã¯<strong>${yNeed}</strong>ã§å®‰å¿ƒã—ã‚„ã™ãã€å½¼ã¯<strong>${hNeed}</strong>ã§å®‰å¿ƒã—ã‚„ã™ã„ã€‚<br>ç‰‡æ–¹ã ã‘ã®ã‚„ã‚Šæ–¹ã«å¯„ã›ãšã€<strong>äºŒæ®µæ§‹ãˆ</strong>ã«ã™ã‚‹ã€‚`;
    })();

    const script = (() => {
      // mini script template
      if(gapApproach === "å¯„ã‚‹Ã—é›¢ã‚Œã‚‹" || gapApproach === "é›¢ã‚Œã‚‹Ã—å¯„ã‚‹"){
        return `ä¾‹ï¼š<br>ã€Œä»Šã¡ã‚‡ã£ã¨ä¸å®‰ã«ãªã£ã¦ã‚‹ã€‚<strong>â—¯æ™‚ã«5åˆ†ã ã‘</strong>è©±ã›ã‚‹ï¼Ÿ ãã‚Œã¾ã§ã¯å¾…ã¤ã­ã€‚ã€<br>ï¼ˆè¿½ã„ã™ããšã€æ¶ˆãˆã™ããšã€ç´„æŸã§å®‰å¿ƒã‚’ä½œã‚‹ï¼‰`;
      }
      if(Y.channel === "è¨€è‘‰" || H.channel === "è¨€è‘‰"){
        return `ä¾‹ï¼š<br>ã€Œçµè«–ã ã‘èã‹ã›ã¦ã€‚<strong>ä»Šã¯å¤§ä¸ˆå¤«ï¼Ÿ</strong>ã€<br>ï¼ˆé•·æ–‡ã‚ˆã‚Šâ€œçŸ­ã„ç¢ºèªâ€ãŒåŠ¹ãï¼‰`;
      }
      return `ä¾‹ï¼š<br>ã€Œä»Šæ—¥ã¯ä¸€ç·’ã«ã„ã‚ˆã†ã€‚<strong>è¨€è‘‰ãŒãªãã¦ã‚‚</strong>ãã°ã«ã„ã‚‹ã­ã€‚ã€<br>ï¼ˆä½“æ„Ÿã®å®‰å¿ƒã‚’å…ˆã«ä½œã‚‹ï¼‰`;
    })();

    const dont = (() => {
      if(gapApproach === "å¯„ã‚‹Ã—é›¢ã‚Œã‚‹"){
        return "ã‚„ã‚‰ãªã„ï¼š<strong>è¿½ã„LINEï¼å³ç­”ã®å¼·åˆ¶</strong>ï¼ˆé›¢ã‚Œã‚‹å´ã®é˜²è¡›ãŒå¼·ããªã‚‹ï¼‰";
      }
      if(gapApproach === "é›¢ã‚Œã‚‹Ã—å¯„ã‚‹"){
        return "ã‚„ã‚‰ãªã„ï¼š<strong>æ”¾ç½®ã§è©¦ã™</strong>ï¼ˆå¯„ã‚‹å´ã®ä¸å®‰ãŒå¢—å¹…ã—ã‚„ã™ã„ï¼‰";
      }
      if(Y.tempo !== H.tempo){
        return "ã‚„ã‚‰ãªã„ï¼š<strong>ãƒšãƒ¼ã‚¹ã‚’åˆã‚ã›ã•ã›ã‚‹</strong>ï¼ˆæ—©ã„ï¼æ…é‡ã®æ‘©æ“¦ãŒå¢—ãˆã‚‹ï¼‰";
      }
      return "ã‚„ã‚‰ãªã„ï¼š<strong>æ­£ã—ã•ã§æŠ¼ã™</strong>ï¼ˆå®‰å¿ƒã®å›å¾©ãŒé…ããªã‚‹ï¼‰";
    })();

    return { gapApproach, gapConfirm, do1, do2, script, dont };
  }

  // ---- State + render ----
  let youData = null;
  let himData = null;

  function renderAll(){
    const out = document.getElementById("out");
    out.style.display = "block";

    // If only one computed, show single card. If both, show compare + guide.
    const cards = [];
    if(youData) cards.push(renderCard("Your Moon Sign", youData));
    if(himData) cards.push(renderCard("His Moon Sign", himData));

    let html = `
      <div class="result-title">DEEP LOVERS LAB</div>
      <div class="compare-grid">${cards.join("")}</div>
      <p class="moon-note">
        æœˆæ˜Ÿåº§ã¯ã€æ€§æ ¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
        <span>ã©ã†æ‰±ã‚ã‚Œã‚‹ã¨ã€å®‰å¿ƒã§ãã‚‹ã‹</span>ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
      </p>
    `;

    if(youData && himData){
      const g = mismatchGuide(youData.sign, himData.sign);
      if(g){
        html += `
          <section class="deep-section">
            <h3>ã‚ºãƒ¬ã®æ‰±ã„æ–¹ï¼ˆä»Šã“ã“ã§åŠ¹ãï¼‰</h3>
            <p>
              äºŒäººã®ã‚ºãƒ¬ï¼š<strong>${g.gapApproach}</strong> ï¼ ç¢ºèªè»¸ï¼š<strong>${g.gapConfirm}</strong>
            </p>

            <ul class="deep-list">
              <li>${g.do1}</li>
              <li>${g.do2}</li>
            </ul>

            <p><strong>è¨€ã„æ–¹ãƒ†ãƒ³ãƒ—ãƒ¬</strong><br>${g.script}</p>
            <p class="deep-note">${g.dont}</p>
          </section>

          <section class="deep-section">
            <h3>å½¼ã®æœˆæ˜Ÿåº§ã‚’çŸ¥ã‚‹ã¨ã€ä½•ãŒã‚ã‹ã‚‹ï¼Ÿ</h3>
            <p>
              å½¼ã®æ…‹åº¦ãŒå¤‰ã‚ã£ãŸã‚ˆã†ã«æ„Ÿã˜ã‚‹ã¨ãã€<br>
              ãã‚Œã¯æ°—æŒã¡ãŒå†·ã‚ãŸã‹ã‚‰ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚
            </p>
            <p>
              æœˆæ˜Ÿåº§ã¯ã€<strong>ä¸å®‰ã«ãªã£ãŸã¨ãã«ç„¡æ„è­˜ã§å‡ºã‚‹åå¿œ</strong>ã‚’è¡¨ã—ã¾ã™ã€‚
            </p>
            <ul class="deep-list">
              <li>ãªãœè·é›¢ã‚’å–ã‚‹ã®ã‹</li>
              <li>ãªãœè¨€è‘‰ãŒæ¸›ã‚‹ã®ã‹</li>
              <li>ãªãœæ€¥ã«å„ªã—ããªã‚‹ã®ã‹</li>
            </ul>
            <p class="deep-note">
              ã€Œã‚ºãƒ¬ã€ï¼çµ‚ã‚ã‚Šã§ã¯ãªãã€æ‰±ã„æ–¹ãŒåˆ†ã‹ã‚‹ã ã‘ã§é–¢ä¿‚ã¯è’ã‚Œãªããªã‚Šã¾ã™ã€‚
            </p>
          </section>

          <div class="hr"></div>
          <div class="note">
            ã‚ãªãŸï¼šæœˆã®é»„çµŒ <span class="mono">${youData.lon.toFixed(2)}Â°</span>ï¼ˆæ˜Ÿåº§å†… <span class="mono">${youData.degInSign.toFixed(2)}Â°</span>ï¼‰<br>
            å½¼ï¼šæœˆã®é»„çµŒ <span class="mono">${himData.lon.toFixed(2)}Â°</span>ï¼ˆæ˜Ÿåº§å†… <span class="mono">${himData.degInSign.toFixed(2)}Â°</span>ï¼‰
          </div>
        `;
      }
    } else {
      html += `
        <section class="deep-section">
          <h3>ãƒ’ãƒ³ãƒˆ</h3>
          <p class="deep-note">
            ã‚‚ã†ä¸€äººã‚‚å…¥åŠ›ã™ã‚‹ã¨ã€äºŒäººã‚’ä¸¦ã¹ã¦ã€Œã‚ºãƒ¬ã®æ‰±ã„æ–¹ã€ã¾ã§è¡¨ç¤ºã—ã¾ã™ã€‚
          </p>
        </section>
      `;
    }

    out.innerHTML = html;
  }

  // ---- Button events ----
  document.getElementById("calc").addEventListener("click", () => {
    const dateStr = document.getElementById("date").value;
    const timeStr = document.getElementById("time").value;
    const tzStr   = document.getElementById("tz").value;

    const data = computeMoon(dateStr, timeStr, tzStr);
    if(!data){
      const out = document.getElementById("out");
      out.style.display = "block";
      out.innerHTML = `<div class="note">ã‚ãªãŸã®ç”Ÿå¹´æœˆæ—¥ï¼ˆå¿…é ˆï¼‰ãŒç©ºã§ã™ã€‚</div>`;
      return;
    }
    youData = data;
    renderAll();
  });

  document.getElementById("calc_partner").addEventListener("click", () => {
    const dateStr = document.getElementById("p_date").value;
    const timeStr = document.getElementById("p_time").value;
    const tzStr   = document.getElementById("p_tz").value;

    const data = computeMoon(dateStr, timeStr, tzStr);
    if(!data){
      const out = document.getElementById("out");
      out.style.display = "block";
      out.innerHTML = `<div class="note">å½¼ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆå¿…é ˆï¼‰ãŒç©ºã§ã™ã€‚</div>`;
      return;
    }
    himData = data;
    renderAll();
  });
</script>
</body>
</html>
